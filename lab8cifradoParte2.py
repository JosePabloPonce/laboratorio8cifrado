import pyDH
import base64
from cryptography.fernet import Fernet

d1 = pyDH.DiffieHellman(group=14)
p = 32317006071311007300338913926423828248817941241140239112842009751400741706634354222619689417363569347117901737909704191754605873209195028853758986185622153212175412514901774520270235796078236248884246189477587641105928646099411723245426622522193230540919037680524235519125679715870117001058055877651038861847280257976054903569732561526167081339361799541336476559160368317896729073178384589680639671900977202194168647225871031411336429319536193471636533209717077448227988588565369208645296636077250268955505928362751121174096972998068410554359584866583291642136218231078990999448652468262416972035911852507045361090559
# p = d1.p()
g = 2
# g = d1.g()
d1_pubkey = 13125023124712144762667292054557742645847964629841796690443474392011256654034289821430624192618850426416401232754306391613224783360907418094333973542780947102290036654623825872144924262225684658193665217954940146917199934720423961709816424255230529708776071560887975588399236184050027274720982462172080120144006529824560758023465167527686188614977757640884297080329965480780064753227522619522912898736631057928305518224515451213901158157495977882591137930623875928110173754955042454153724180967121275688203721842434528106591579290829394397172410317317842495495296641831661367824420486895958754966256417675820346692645
# d1_pubkey = d1.gen_public_key()
d1_privkey = 32278208469645778146997698760350595328397922086591335466540488019707024218578
# d1_privkey = d1.get_private_key()

file1 = open("mypubkey.txt","w")
file1.write(str(d1_pubkey))
file1.close()

file2 = open("pubkey.txt","r")
data = file2.read()
file2.close()

cypherKey = pow(int(data),d1_privkey,p)

mensaje = "Hola! Bien, gracias. La de ustedes que tal?"

fernet = Fernet(base64.urlsafe_b64encode(bytes(str(cypherKey)[len(str(cypherKey))-32:len(str(cypherKey))].encode('UTF-8'))))

cypherMessage = fernet.encrypt(mensaje.encode('UTF-8'))
file3 = open("response.txt","w")
file3.write(cypherMessage.decode('UTF-8'))
file3.close()

file4 = open('question.txt', 'r')
data4 = file4.read()
print("Pregunta del otro grupo:")
print(fernet.decrypt(data4.encode('UTF-8')))
file4.close()

file5 = open('response.txt', 'r')
data5 = file5.read()
print("\nRespuesta y pregunta de nuestro grupo:")
print(fernet.decrypt(data5.encode('UTF-8')))
file5.close()